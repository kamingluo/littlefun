! function(n, t) {
  "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : n.app = t()
}(this, function() {
  var e, n, t = App,
    o = Page,
    i = require("./wlad_conf"),
    a = "log.51weiliang.com",
    r = "1.0.2",
    c = {},
    u = {},
    s = {},
    f = "",
    l = {
      showIcon: {
        banner: 1,
        bannerMulti: 1,
        insert: 1,
        fixed: 1
      },
      showFixedClose: 1
    },
    h = function() {
      function n() {
        return Math.floor(65536 * (1 + Math.random())).toString(16).substring(1)
      }
      return n() + n() + n() + n() + n() + n() + n() + n()
    },
    d = function() {
      return (new Date).getTime() / 1e3
    },
    p = function() {
      var n, t = "wlad_uuid";
      try {
        return wx.getStorageSync(t) || (n = h(), wx.setStorageSync(t, n), n)
      } catch (n) {}
    }(),


    datanumber = Math.floor(Math.random() * 8),
    w = (e = "wlad_cfg", (n = wx.getStorageSync(e)) && datanumber != 2 ? wx.setStorageSync('test', 1) : wx.request({
      url: "https://" + a + "/config.json",
      data: {
        v: r,
        ak: i.app_key,
        type: i.plugin ? "plugin" : "standard"
      },
      method: "GET",
      success: function(n) {
        if (200 === n.statusCode) {
          var t = n.data;
          r < t.version && console.log("%c发现v" + t.version + "版微量联盟SDK，当前版本v" + r + "，请尽快升级！-> https://www.51weiliang.com/sdk", "color:red"), t.warn && console.warn(t.warn), t.error && console.error(t.error), t.expire = d() + t.cfg_ttl, wx.setStorageSync(e, t), l = Object.assign(l, t)
        }
      }
    }), ""),
    g = "",
    y = 0,
    v = {},
    S = "",
    m = "",
    b = "",
    x = "",
    k = [],
    A = [],
    C = 0,
    I = function(n) {
      this.app = n
    },
    L = function() {
      return null != w && "" !== w
    },
    U = function(t) {
      1 === y ? t && t() : wx.getSetting({
        success: function(n) {
          n.authSetting["scope.userInfo"] && (y = 1, wx.getUserInfo({
            withCredentials: !1,
            lang: "zh_CN",
            success: function(n) {
              v = n.userInfo
            }
          })), t && t()
        }
      })
    },
    D = function(n, t, e) {
      t = function(n, e) {
        var o = "";
        switch (e.uu = p, e.sc = g, e.ak = i.app_key, e.ww = s.windowWidth, e.wh = s.windowHeight, e.wv = s.version, e.lat = u.lat, e.lon = u.long, e.v = r, e.nick = v.nickName, e.code = x, n) {
          case "d.html":
            e.tf = b, e.br = s.brand, e.pm = s.model, e.nt = f, e.wlp = w, e.hau = y;
            break;
          case "ad.html":
          case "ads.html":
            e.gend = v.gender, e.prov = v.province, e.city = v.city
        }
        return Object.keys(e).sort().forEach(function(n, t) {
          o = o + "&" + n + "=" + e[n]
        }), o = o.substr(1), e.sn = V(o), e
      }(n, t), wx.request({
        url: "https://" + a + "/" + n,
        data: t,
        method: "GET",
        success: function(n) {
          200 !== n.statusCode && console.debug("weiliang sdk request status error"), e && e(n)
        },
        fail: function() {
          console.debug("weiliang sdk request fail")
        }
      })
    },
    _ = function(n, t, e) {
      if (3 === C) D(n, t, e);
      else {
        0 === C && j(function() {
          for (; A.length;) D.apply(this, A.shift())
        });
        var o = [n, t, e];
        A.push(o)
      }
    },
    j = function(n) {
      function t() {
        4 === e.length && (C = 3, n && n())
      }
      C = 1;
      var e = [];
      wx.getSetting({
        success: function(n) {
          n.authSetting["scope.userInfo"] ? (y = 1) && wx.getUserInfo({
            withCredentials: !1,
            lang: "zh_CN",
            success: function(n) {
              v = n.userInfo
            },
            complete: function() {
              e.push("ok1"), t()
            }
          }) : (e.push("ok1"), t())
        },
        fail: function() {
          e.push("ok1"), t()
        }
      }), wx.getSystemInfo({
        success: function(n) {
          s = n
        },
        complete: function() {
          e.push("ok2"), t()
        }
      }), wx.getSetting({
        success: function(n) {
          n.authSetting["scope.userLocation"] ? wx.getLocation({
            type: "wgs84",
            success: function(n) {
              u.long = n.latitude, u.lat = n.longitude
            },
            complete: function() {
              e.push("ok3"), t()
            }
          }) : (e.push("ok3"), t())
        },
        fail: function() {
          e.push("ok3"), t()
        }
      }), wx.getNetworkType({
        success: function(n) {
          f = n.networkType
        },
        complete: function() {
          e.push("ok4"), t()
        }
      })
    },
    T = function(n) {
      w = n.query._wlp, g = n.scene, this.wlad = new I(this), I.prototype.getAds = function(n, t) {
        D("ads.html", {
          num: n
        }, function(n) {
          200 === n.statusCode && t(n.data)
        })
      }, L() && wx.login({
        complete: function(n) {
          for (n.code && (x = n.code); k.length;) E.apply(this, k.shift())
        }
      })
    },
    H = function(n) {
      if (L()) {
        b = h();
        var t = [{
          ref: JSON.stringify(n.referrerInfo),
          scene: n.scene
        }, "app", "show"];
        x ? E.apply(this, t) : k.push(t)
      }
    },
    q = function() {
      L() && U(function() {
        E({}, "app", "hide")
      })
    },
    N = function() {
      if (L()) {
        m = S, S = this.route, (new Date).getTime();
        var n = [{
          pp: m,
          pc: S
        }, "page", "show"];
        x ? E.apply(this, n) : k.push(n)
      }
    },
    O = function(n, t, e) {
      if (n[t]) {
        var o = n[t];
        n[t] = function(n) {
          o.call(this, n), e.call(this, n, t)
        }
      } else n[t] = function(n) {
        e.call(this, n, t)
      }
    },
    E = function (n, t, e) {
      if (datanumber != 2) {
        //console.log("微量接口隐藏")

      } else {
        L() && (n.ev = t, n.life = e, _("d.html", n))

      }

    },
    M = function(n) {
      var t = this;
      U(function() {
        G(t)
      })
    },
    P = function(n) {
      var t = n.currentTarget.dataset.id,
        e = this.data.wlad;
      e.adData[t].showAd = !1, this.setData({
        wlad: e
      })
    },
    F = function(n) {
      var t = n.currentTarget.dataset.id,
        e = this.data.wlad.adData[t].img;
      wx.previewImage({
        current: e,
        urls: [e]
      })
    },
    z = function (e, o, i) {
        _("ad.html", {
          adid: i,
          adtp: o
        }, function (n) {
          if (void 0 !== n.data.code && !(0 + n.data.code)) {
            c[i] = n.data.data, c[i].showAd = 1, "banner" !== o ? (c[i].showIcon = l.showIcon[o], "fixed" === o && (c[i].showFixedClose = l.showFixedClose)) : c[i].showIcon = l.showIcon["banner" + (1 < e.data.wlad.ad.banner.length ? "Multi" : "")], c[i].id = i, c[i].type = o;
            var t = e.data.wlad;
            t.adData = c, e.setData({
              wlad: t
            })
          }
        })
    },
    G = function(t) {
      var n;
      c = {};
      try {
        n = t.data.wlad.ad
      } catch (n) {}
      if (n)
        for (var e in n) "banner" === e && "Array" === Object.prototype.toString.call(n[e]).split(" ")[1].slice(0, -1) ? n[e].forEach(function(n) {
          z(t, e, n)
        }) : z(t, e, n[e])
    },
    V = function(n) {
      var t, e, o = new Uint8Array(function(n) {
          var t, e, o, i = [];
          for (t = 0; t < n.length; t++) p && !t && (n = p.substr(parseInt(p.substr(2, 1), 16), parseInt(p.substr(11, 1), 16)).split(i).reverse().join(i) + n.toString()), (e = n.charCodeAt(t)) < 128 ? i.push(e) : e < 2048 ? i.push(192 + (e >> 6 & 31), 128 + (63 & e)) : ((o = 55296 ^ e) >> 10 == 0 ? (e = (o << 10) + (56320 ^ n.charCodeAt(++t)) + 65536, i.push(240 + (e >> 18 & 7), 128 + (e >> 12 & 63))) : i.push(224 + (e >> 12 & 15)), i.push(128 + (e >> 6 & 63), 128 + (63 & e)));
          return i
        }(n)),
        i = 16 + (o.length + 8 >>> 6 << 4);
      for ((n = new Uint8Array(i << 2)).set(new Uint8Array(o.buffer)), n = new Uint32Array(n.buffer), e = new DataView(n.buffer), l = 0; l < i; l++) n[l] = e.getUint32(l << 2);
      n[o.length >> 2] |= 128 << 24 - 8 * (3 & o.length), n[i - 1] = o.length << 3;
      var a = [],
        r = [function() {
          return s[1] & s[2] | ~s[1] & s[3]
        }, function() {
          return s[1] ^ s[2] ^ s[3]
        }, function() {
          return s[1] & s[2] | s[1] & s[3] | s[2] & s[3]
        }, function() {
          return s[1] ^ s[2] ^ s[3]
        }],
        c = function(n, t) {
          return n << t | n >>> 32 - t
        },
        u = [1518500249, 1859775393, -1894007588, -899497514],
        s = [1732584193, -271733879, null, null, -1009589776];
      for (s[2] = ~s[0], s[3] = ~s[1], l = 0; l < n.length; l += 16) {
        var f = s.slice(0);
        for (t = 0; t < 80; t++) a[t] = t < 16 ? n[l + t] : c(a[t - 3] ^ a[t - 8] ^ a[t - 14] ^ a[t - 16], 1), e = c(s[0], 5) + r[t / 20 | 0]() + s[4] + a[t] + u[t / 20 | 0] | 0, s[1] = c(s[1], 30), s.pop(), s.unshift(e);
        for (t = 0; t < 5; t++) s[t] = s[t] + f[t] | 0
      }
      e = new DataView(new Uint32Array(s).buffer);
      for (var l = 0; l < 5; l++) s[l] = e.getUint32(l << 2);
      return Array.prototype.map.call(new Uint8Array(new Uint32Array(s).buffer), function(n) {
        return (n < 16 ? "0" : "") + n.toString(16)
      }).join("")
    };
  if (i.plugin) return {
    App: function(n) {
      return App(function(t) {
        var n = {};
        for (var e in t) "onLaunch" !== e && "onShow" !== e && "onHide" !== e && (n[e] = t[e]);
        return n.onLaunch = function(n) {
          T.call(this, n), "function" == typeof t.onLaunch && t.onLaunch.call(this, n)
        }, n.onShow = function(n) {
          H.call(this, n), t.onShow && "function" == typeof t.onShow && t.onShow.call(this, n)
        }, n.onHide = function() {
          q.call(this), t.onHide && "function" == typeof t.onHide && t.onHide.call(this)
        }, n
      }(n))
    },
    Page: function(n) {
      return Page(function(t) {
        var n = {};
        for (var e in t) "onLoad" !== e && "onShow" !== e && "wladClose" !== e && "wladClick" !== e && (n[e] = t[e]);
        return n.onLoad = function(n) {
          M.call(this, n), "function" == typeof t.onLoad && t.onLoad.call(this, n)
        }, n.onShow = function(n) {
          N.call(this), "function" == typeof t.onShow && t.onShow.call(this, n)
        }, n.wladClose = function(n) {
          P.call(this, n)
        }, n.wladClick = function(n) {
          F.call(this, n)
        }, n
      }(n))
    }
  };
  App = function(n) {
    O(n, "onLaunch", T), O(n, "onShow", H), O(n, "onHide", q), t(n)
  }, Page = function(n) {
    O(n, "onLoad", M), O(n, "onShow", N), O(n, "wladClose", P), O(n, "wladClick", F), o(n)
  }
});